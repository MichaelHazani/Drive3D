function init(){function e(n){n.alpha&&(controls=new THREE.DeviceOrientationControls(camera,!0),controls.connect(),controls.update(),element.addEventListener("click",fullscreen,!1),window.removeEventListener("deviceorientation",e,!0))}renderer=new THREE.WebGLRenderer({alpha:!0}),element=renderer.domElement,container=document.getElementById("example"),container.appendChild(element),effect=new THREE.StereoEffect(renderer),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(90,1,.001,6e3),camera.position.set(0,10,0),scene.add(camera),controls=new THREE.FirstPersonControls(camera),controls.movementSpeed=0,controls.lookSpeed=.25,controls.noFly=!0,controls.lookVertical=!0,window.addEventListener("deviceorientation",e,!0),window.addEventListener("keypress",function(e){console.log(e),112==e.keyCode&&(isPaused=!isPaused)},!0);var n=new THREE.HemisphereLight(16777215,0,1);n.position.set(0,10,0),scene.add(n);var t=new THREE.AmbientLight(16777215,1);scene.add(t);var o=(new THREE.TextureLoader).load("images/textures/patterns/checker.png");o.wrapS=THREE.RepeatWrapping,o.wrapT=THREE.RepeatWrapping,o.repeat=new THREE.Vector2(50,50),o.anisotropy=renderer.getMaxAnisotropy();var r=new THREE.MeshPhongMaterial({color:2236962,specular:16777215,shininess:20,shading:THREE.FlatShading,map:o}),a=new THREE.PlaneGeometry(500,500),i=new THREE.Mesh(a,r);i.name="plane",i.rotation.x=-Math.PI/2,i.position.y=-3,scene.add(i);for(var s="images/skybox/new2/",l=["xpos","xneg","ypos","yneg","zpos","zneg"],c=".png",d=new THREE.BoxGeometry(5e3,5e3,5e3),p=[],u=0;6>u;u++)p.push(new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load(s+l[u]+c),side:THREE.BackSide}));var m=new THREE.MeshFaceMaterial(p),f=new THREE.Mesh(d,m);scene.add(f),window.addEventListener("resize",resize,!1),setTimeout(resize,1);var E=document.createElement("img");E.src="./images/crosshair.png",E["class"]="chair",E.style.position="absolute",document.body.appendChild(E),E.style.top=window.innerHeight/2+"px",E.style.left=window.innerWidth/2+"px",getFiles(PATH)}function getFiles(e){function n(e){function n(e,n,t,o){colladaLoader.load("models/folder2.dae",function(r){var a=r.scene.children[0].children[0],i=new THREE.Object3D;i.add(new THREE.Mesh(a.geometry,a.material)),i.scale.set(10,10,10),i.rotateX(radians(90)),i.rotateY(radians(340)),i.name=o.name,i.tier=floor,i.position.set(e,n,t),scene.add(i),folders.push(i),folderContainer[folderContainer.length-1].push(i),tl.to(i.position,1,{y:n,timeScale:6,ease:Quad.easeOut},.8)})}function t(e,n,t,o){var r=new THREE.FontLoader;r.load("fonts/helvetiker_regular.typeface.json",function(r){var a=new THREE.TextGeometry(o.name,{font:r,size:4,height:.1,curveSegments:6,bevelThickness:1,bevelSize:.1,bevelEnabled:!1});a.computeBoundingBox();var i=new THREE.Mesh(a,new THREE.MeshPhongMaterial({color:0,specular:16777215})),s=i.geometry.boundingBox.max.x/2;a.applyMatrix((new THREE.Matrix4).makeTranslation(-1*s,0,0)),i.position.set(e,n+25,t),i.tier=floor,i.lookAt(camera.position),scene.add(i),folderContainer[folderContainer.length-1].push(i)})}var o=80,r=radians(0),a=radians(50),i=radians(360/e.entries.length);folderContainer.push([]);for(entry in e.entries){var s=o*Math.cos(r)*Math.sin(a),l=o*Math.sin(r)*Math.sin(a)+floor*multiplier,c=o*Math.cos(a);n(s,l,c,e.entries[entry]),t(s,l,c,e.entries[entry]),a-=i}}var t=new Dropbox({accessToken:"jP-3gUxYcvgAAAAAAABlsZHqfu6yw81fpKwUNvrz509F7BndLSErAGguza6hHqUJ"});t.filesListFolder({path:e}).then(function(e){n(e)})["catch"](function(e){console.log(e)})}function rayCast(){raycaster.setFromCamera(ray,camera);var e=raycaster.intersectObjects(scene.children,!0);if(0!=e.length&&"plane"!=e[0].object.name){if(!stareAtObject){var n=e[0].object.parent.name;open(n)}}else 0==e.length?(stareAtObject=!1,clearTimeout(stareTimeout)):0!=e.length&&"plane"==e[0].object.name&&floor>0&&(stareAtObject||open())}function open(e){void 0!=e?(stareAtObject=!0,console.log("staring at "+e),stareTimeout=setTimeout(function(){console.log("going up!"),PATH+="/"+e,floor+=1,getFiles(PATH),console.log("Upward path is: "+PATH),travel(),stareAtObject=!1},2e3)):(stareAtObject=!0,console.log("staring at the ground"),stareTimeout=setTimeout(function(){console.log("removing "+folderContainer[floor].length+"objects from floor "+floor);for(item in folderContainer[floor])scene.remove(folderContainer[floor][item]);if(folderContainer.pop(),console.log("going down!"),console.log("pre split PATH is "+PATH),-1!=PATH.indexOf("/")){var e=PATH.split("/");e.pop(),console.log(e),console.log("newPath post split is "+e),e.pop(),console.log("post pop newpath is "+e),PATH=e}console.log("Downward path is: "+PATH),floor-=1,travel(),stareAtObject=!1},2e3))}function travel(){controls.target.set(0,floor*multiplier,0),tl.to(camera.position,1,{y:floor*multiplier,ease:Quad.easeOut})}function render(e){rayCast(),renderer.render(scene,camera)}function animate(e){for(folder in folders)folders[folder].rotation.z-=.01;requestAnimationFrame(animate),update(clock.getDelta()),render(clock.getDelta())}function radians(e){return e*Math.PI/180}function resize(){var e=container.offsetWidth,n=container.offsetHeight;camera.aspect=e/n,camera.updateProjectionMatrix(),effect.setSize(e,n)}function update(e){resize(),camera.updateProjectionMatrix(),isPaused||controls.update(e)}function fullscreen(){container.requestFullscreen?container.requestFullscreen():container.msRequestFullscreen?container.msRequestFullscreen():container.mozRequestFullScreen?container.mozRequestFullScreen():container.webkitRequestFullscreen&&container.webkitRequestFullscreen()}var camera,scene,renderer,effect,controls,element,container,clock=new THREE.Clock,raycaster=new THREE.Raycaster,ray=new THREE.Vector2;ray.x=0,ray.y=0;var colladaLoader=new THREE.ColladaLoader;colladaLoader.options.convertUpAxis=!0;var isPaused=!1,folder,folders=[],folderContainer=[],stareAtObject=!1,stareTimeout,PATH="",floor=0,multiplier=130,tl=new TimelineLite;init(),animate();